<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy X </title>
    
    <!-- Mixpanel (replaces Google Analytics) -->
    <script type="text/javascript">
      (function(e,c){if(!c.__SV){var l,h;window.mixpanel=c;c._i=[];c.init=function(q,r,f){function t(d,a){var g=a.split(".");2==g.length&&(d=d[g[0]],a=g[1]);d[a]=function(){d.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";b.people=b.people||[];b.toString=function(d){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);d||(a+=" (stub)");return a};b.people.toString=function(){return b.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders start_session_recording stop_session_recording people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
      for(h=0;h<l.length;h++)t(b,l[h]);var n="set set_once union unset remove delete".split(" ");b.get_group=function(){function d(p){a[p]=function(){b.push([g,[p].concat(Array.prototype.slice.call(arguments,0))])}}for(var a={},g=["get_group"].concat(Array.prototype.slice.call(arguments,0)),m=0;m<n.length;m++)d(n[m]);return a};c._i.push([q,r,f])};c.__SV=1.2;var k=e.createElement("script");k.type="text/javascript";k.async=!0;k.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===
      e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=e.getElementsByTagName("script")[0];e.parentNode.insertBefore(k,e)}})(document,window.mixpanel||[])
      
      mixpanel.init('f799f92a2dd5f2ca817e24ec762c5303', {
        autocapture: false, 
        record_sessions_percent: 0
      })

      // Identify user consistently
      ;(function(){
        let userId = localStorage.getItem('flappyUserId');
        if (!userId) {
          const ts = Date.now();
          const rand = Math.random().toString(36).substring(2, 15);
          userId = `user_${ts}_${rand}`;
          localStorage.setItem('flappyUserId', userId);
        }
        mixpanel.identify(userId);
        mixpanel.register({ user_id: userId });
      })();
    </script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/favicon-256x256.png">
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    
    <!-- Cache Control for Mobile -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Cache-busted resources -->
    <link rel="stylesheet" href="styles/styles.css?v=3.2.0">
</head>
<body>
    <!-- Full Screen Game Container -->
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <!-- Game UI Overlay -->
        <div class="game-ui">
            <!-- Start Screen (minimal) -->
            <div id="startScreen" class="screen">
                <div class="start-minimal">
                    <h1 class="game-title">ğŸ¦ Flappy X</h1>
                    <p class="start-instructions">Tap anywhere to start</p>

                    <div class="start-actions">
                        <button id="toggleMusic" class="small-btn">ğŸ”Š Music</button>
                        <button id="openLeaderboard" class="small-btn">ğŸ† View Leaderboard</button>
                        <button id="openSettings" class="small-btn">ğŸ¨ Customize Your Game</button>
                    </div>

                    <!-- Start screen leaderboard (toggle) -->
                    <div id="startLeaderboard" class="leaderboard-section" style="display:none; max-height: 280px;">
                        <div class="leaderboard-header" style="margin-top:0;">
                            <h3 class="leaderboard-title">ğŸ† Global Leaderboard</h3>
                        </div>
                        <ol id="startLeaderboardList" class="leaderboard-list">
                            <li>Loading...</li>
                        </ol>
                        <div style="display:flex; gap:0.5rem; justify-content:center; margin-top:0.5rem;">
                            <button id="refreshLeaderboard" class="refresh-btn" style="max-width:180px;">ğŸ”„ Refresh</button>
                            <button id="closeStartLeaderboard" class="small-btn">âœ– Close</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Game Over Screen -->
            <div id="gameOverScreen" class="screen hidden">
                <div class="gameover-container">
                    <div class="gameover-header">
                        <div class="result-icon">ğŸ</div>
                        <h2 class="gameover-title">Adventure Complete!</h2>
                        <div class="result-subtitle">How did you do?</div>
                    </div>
                    
                    <div class="score-section">
                        <div class="score-card current-score">
                            <div class="score-label">Your Score</div>
                            <div class="score-value" id="finalScore">0</div>
                        </div>
                        <div class="score-card best-score">
                            <div class="score-label">Best Score</div>
                            <div class="score-value" id="bestScore">0</div>
                        </div>
                    </div>
                    
                    <div class="achievement-section">
                        <div class="achievement-message" id="achievementMessage">
                            <span class="achievement-icon">ğŸŒŸ</span>
                            <span class="achievement-text">Great job!</span>
                        </div>
                    </div>
                    
                    <!-- Player Name Input -->
                    <div class="player-name-section">
                        <div class="name-input-container">
                            <label for="playerNameInput" class="name-label">ğŸ‘¤ Enter your name:</label>
                            <div class="name-input-wrapper">
                                <input type="text" id="playerNameInput" class="name-input" maxlength="20" placeholder="Player Name">
                                <button id="saveNameBtn" class="save-name-btn">ğŸ’¾ Save</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Leaderboard Display -->
                    <div class="leaderboard-section">
                        <div class="leaderboard-header">
                            <h3 class="leaderboard-title">ğŸ† Global Leaderboard</h3>
                            <div class="leaderboard-status">
                                <span id="leaderboardStatus" class="status-text">ğŸ“¡ Connecting...</span>
                                <span id="totalPlayers" class="player-count" style="display: none;">ğŸ‘¥ <span id="playerCount">0</span> players</span>
                            </div>
                        </div>
                        <ol id="leaderboardList" class="leaderboard-list">
                            <li>Loading...</li>
                        </ol>
                        <button id="refreshLeaderboard" class="refresh-btn">ğŸ”„ Refresh Leaderboard</button>
                    </div>
                    
                    <div class="gameover-actions">
                        <button id="restartBtn" class="game-btn primary restart-btn">
                            <span class="btn-icon">ğŸ”„</span>
                            <span class="btn-text">New Adventure</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- In-Game HUD -->
            <div id="gameHUD" class="hud">
                <div id="score" class="score-display">0</div>
                <div id="difficulty" class="difficulty-display">Easy Mode</div>
            </div>
        </div>
        
        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel hidden">
            <div class="panel-header">
                <h3>ğŸ® Game Settings</h3>
                <button id="closeSettingsBtn" class="close-btn">&times;</button>
            </div>
            
            <!-- Customization Section -->
            <div class="setting-section customization-section">
                <h4>ğŸ¨ Customization</h4>
                
                <!-- Bird Sprite -->
                <div class="upload-group">
                    <input type="file" id="birdUpload" accept="image/*">
                    <label for="birdUpload" class="upload-btn">ğŸ¦ Bird Sprite</label>
                </div>
                
                <!-- Audio Files -->
                <div class="audio-uploads">
                    <h5>ğŸµ Custom Audio</h5>
                    <div class="upload-group">
                        <input type="file" id="tapSoundUpload" accept="audio/*">
                        <label for="tapSoundUpload" class="upload-btn">ğŸ”Š Tap Sound</label>
                        <button id="removeTapSound" class="remove-btn" title="Remove custom tap sound">âŒ</button>
                    </div>
                    
                    <div class="upload-group">
                        <input type="file" id="crashSoundUpload" accept="audio/*">
                        <label for="crashSoundUpload" class="upload-btn">ğŸ’¥ Crash Sound</label>
                        <button id="removeCrashSound" class="remove-btn" title="Remove custom crash sound">âŒ</button>
                    </div>
                    
                    <div class="upload-group">
                        <input type="file" id="pointSoundUpload" accept="audio/*">
                        <label for="pointSoundUpload" class="upload-btn">ğŸ¯ Point Sound</label>
                        <button id="removePointSound" class="remove-btn" title="Remove custom point sound">âŒ</button>
                    </div>
                    
                    <div class="upload-group">
                        <input type="file" id="bgMusicUpload" accept="audio/*">
                        <label for="bgMusicUpload" class="upload-btn">ğŸµ Background Music</label>
                        <button id="removeBgMusic" class="remove-btn" title="Remove custom background music">âŒ</button>
                    </div>
                </div>
            </div>
            
            <!-- Master Volume Section -->
            <div class="setting-section master-section">
                <h4>ğŸ›ï¸ Master Controls</h4>
                <div class="volume-control master-volume">
                    <label for="masterVolumeSlider">ğŸ›ï¸ Master Volume: <span id="masterVolumeDisplay">100%</span></label>
                    <input type="range" id="masterVolumeSlider" min="0" max="100" value="100" class="volume-slider master-slider">
                </div>
                
            </div>
            
            <!-- Audio Volume Controls -->
            <div class="setting-section audio-section">
                <h4>ğŸ”Š Audio Levels</h4>
                
                <div class="volume-grid">
                    <div class="volume-control">
                        <label for="musicVolumeSlider">ğŸµ Music: <span id="musicVolumeDisplay">30%</span></label>
                        <input type="range" id="musicVolumeSlider" min="0" max="100" value="30" class="volume-slider">
                    </div>
                    
                    <div class="volume-control">
                        <label for="tapVolumeSlider">ğŸ”Š Tap: <span id="tapVolumeDisplay">70%</span></label>
                        <input type="range" id="tapVolumeSlider" min="0" max="100" value="70" class="volume-slider">
                    </div>
                    
                    <div class="volume-control">
                        <label for="crashVolumeSlider">ğŸ’¥ Crash: <span id="crashVolumeDisplay">80%</span></label>
                        <input type="range" id="crashVolumeSlider" min="0" max="100" value="80" class="volume-slider">
                    </div>
                    
                    <div class="volume-control">
                        <label for="pointVolumeSlider">ğŸ¯ Point: <span id="pointVolumeDisplay">60%</span></label>
                        <input type="range" id="pointVolumeSlider" min="0" max="100" value="60" class="volume-slider">
                    </div>
                    
                    <div class="volume-control">
                        <label for="powerupVolumeSlider">ğŸš€ Power-up: <span id="powerupVolumeDisplay">60%</span></label>
                        <input type="range" id="powerupVolumeSlider" min="0" max="100" value="60" class="volume-slider">
                    </div>
                </div>
            </div>
            
            
            <!-- Help & Support Section -->
            <div class="setting-section help-section">
                <h4>ğŸ†˜ Help & Support</h4>
                <div class="help-links">
                    <a href="https://discord.gg/nzyvDwnEku" target="_blank" class="discord-link">
                        <img src="assets/icons/discord-icon.svg" alt="Discord" class="discord-icon">
                        Join Discord for Help
                    </a>
                </div>
                <div class="custom-request">
                    <p>ğŸ¨ Need custom character sounds or pics? Let us know in Discord and we'll add them to the game!</p>
                </div>
            </div>
        </div>
        
        <!-- Settings Button -->
        <button id="settingsBtn" class="settings-btn" title="Game Settings">âš™ï¸</button>
        
        <!-- Pause Button -->
        <button id="pauseBtn" class="pause-btn" title="Pause Game">â¸ï¸</button>
        
        <!-- Footer -->
        <div class="footer">
            <a href="https://discord.gg/nzyvDwnEku" target="_blank" class="discord-footer" title="Join Discord for Help">
                <img src="assets/icons/discord-icon.svg" alt="Discord" class="discord-logo">
            </a>
            <div class="version-number">v3.2.0</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- Leaderboard System -->
    <script src="scripts/leaderboard.js?v=3.3.0"></script>
    <script src="scripts/flappy-bird.js?v=3.3.0"></script>
</body>
</html>