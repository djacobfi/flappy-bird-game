<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flappy Bird Adventure</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Epic Flappy Bird game with power-ups, seasons, and customizable assets">
    <meta name="theme-color" content="#4CAF50">
    <meta name="background-color" content="#87CEEB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Flappy Bird">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Flappy Bird">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="96x96" href="icons/icon-96x96.png">
    
    <!-- Standard Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icons/icon-96x96.png">
    <link rel="icon" type="image/png" sizes="72x72" href="icons/icon-72x72.png">
    <link rel="shortcut icon" href="icons/icon-96x96.png">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#4CAF50">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Flappy Bird Adventure">
    <meta property="og:description" content="Epic Flappy Bird game with power-ups, seasons, and customizable assets">
    <meta property="og:image" content="icons/icon-512x512.png">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Flappy Bird Adventure">
    <meta name="twitter:description" content="Epic Flappy Bird game with power-ups, seasons, and customizable assets">
    <meta name="twitter:image" content="icons/icon-512x512.png">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Full Screen Game Container -->
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <!-- Game UI Overlay -->
        <div class="game-ui">
            <!-- Start Screen -->
            <div id="startScreen" class="screen">
                <h1>🐦 Flappy Bird Adventure</h1>
                <p>Journey through changing seasons and holidays!</p>
                <p class="controls-text">Click anywhere, press Space, or tap to fly</p>
                <div class="menu-buttons">
                    <button id="startBtn" class="game-btn primary">🚀 Start Adventure</button>
                    <button id="toggleMusic" class="game-btn secondary">🔊 Music</button>
                </div>
            </div>
            
            <!-- Game Over Screen -->
            <div id="gameOverScreen" class="screen hidden">
                <h2>🏁 Adventure Complete!</h2>
                <div class="score-display">
                    <p>Score: <span id="finalScore" class="score-number">0</span></p>
                    <p>Best: <span id="bestScore" class="score-number">0</span></p>
                </div>
                <button id="restartBtn" class="game-btn primary">🔄 New Adventure</button>
            </div>
            
            <!-- In-Game HUD -->
            <div id="gameHUD" class="hud">
                <div id="score" class="score-display">0</div>
                <div id="difficulty" class="difficulty-display">Easy Mode</div>
            </div>
        </div>
        
        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel hidden">
            <div class="panel-header">
                <h3>🎮 Game Settings</h3>
                <button id="closeSettingsBtn" class="close-btn">&times;</button>
            </div>
            
            <!-- Bird Customization -->
            <div class="setting-section">
                <h4>🐦 Bird Sprite</h4>
                <input type="file" id="birdUpload" accept="image/*">
                <label for="birdUpload" class="upload-btn">Upload Bird Sprite</label>
            </div>
            
            <!-- Audio Settings -->
            <div class="setting-section">
                <h4>🔊 Audio Settings</h4>
                
                <div class="volume-control">
                    <label for="volumeSlider">Music Volume: <span id="volumeDisplay">30%</span></label>
                    <input type="range" id="volumeSlider" min="0" max="100" value="30" class="volume-slider">
                </div>
                
                <input type="file" id="tapSoundUpload" accept="audio/*">
                <label for="tapSoundUpload" class="upload-btn">🔊 Tap Sound</label>
                
                <input type="file" id="crashSoundUpload" accept="audio/*">
                <label for="crashSoundUpload" class="upload-btn">💥 Crash Sound</label>
                
                <input type="file" id="bgMusicUpload" accept="audio/*">
                <label for="bgMusicUpload" class="upload-btn">🎵 Background Music</label>
            </div>
        </div>
        
        <!-- Settings Button -->
        <button id="settingsBtn" class="settings-btn" title="Game Settings">⚙️</button>
        
        <!-- Version Number -->
        <div class="version-number">v2.2.0</div>
    </div>

    <script src="flappy-bird.js"></script>
    
    <!-- PWA Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('✅ Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('🔄 New Service Worker found, installing...');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('🎯 New content available! Please refresh.');
                                    // Optionally show update notification
                                    if (confirm('New version available! Refresh to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('❌ Service Worker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        let installButton = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('💾 PWA install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button if not already installed
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                showInstallButton();
            }
        });

        function showInstallButton() {
            if (installButton) return; // Already showing
            
            installButton = document.createElement('button');
            installButton.textContent = '📱 Install App';
            installButton.className = 'install-btn';
            installButton.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 1000;
                background: #4CAF50;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 20px;
                font-size: 14px;
                cursor: pointer;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                transition: all 0.3s ease;
            `;
            
            installButton.addEventListener('mouseenter', () => {
                installButton.style.background = '#45a049';
                installButton.style.transform = 'scale(1.05)';
            });
            
            installButton.addEventListener('mouseleave', () => {
                installButton.style.background = '#4CAF50';
                installButton.style.transform = 'scale(1)';
            });
            
            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('✅ User accepted PWA install');
                    } else {
                        console.log('❌ User dismissed PWA install');
                    }
                    
                    deferredPrompt = null;
                    installButton.remove();
                    installButton = null;
                }
            });
            
            document.body.appendChild(installButton);
        }

        // Hide install button when app is installed
        window.addEventListener('appinstalled', () => {
            console.log('🎉 PWA installed successfully!');
            if (installButton) {
                installButton.remove();
                installButton = null;
            }
            deferredPrompt = null;
        });

        // Detect if running as PWA
        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('🚀 Running as PWA!');
            document.body.classList.add('pwa-mode');
        }
    </script>
</body>
</html>