<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Optimization Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .device-info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .optimization-info {
            background: #f0f8e8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .performance-info {
            background: #f8f0e8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Mobile Optimization Test Suite</h1>
        <p>This page tests the mobile optimization system for the Flappy Bird game.</p>
        
        <div id="testResults"></div>
        
        <h2>Device Detection Test</h2>
        <div id="deviceInfo" class="device-info">
            <p>Loading device information...</p>
        </div>
        
        <h2>Optimization Settings Test</h2>
        <div id="optimizationInfo" class="optimization-info">
            <p>Loading optimization settings...</p>
        </div>
        
        <h2>Performance Test</h2>
        <div id="performanceInfo" class="performance-info">
            <p>Running performance tests...</p>
        </div>
        
        <h2>Test Controls</h2>
        <button class="test-button" onclick="runDeviceDetectionTest()">Test Device Detection</button>
        <button class="test-button" onclick="runOptimizationTest()">Test Optimizations</button>
        <button class="test-button" onclick="runPerformanceTest()">Test Performance</button>
        <button class="test-button" onclick="simulateMobileDevice()">Simulate Mobile</button>
        <button class="test-button" onclick="simulateTabletDevice()">Simulate Tablet</button>
        <button class="test-button" onclick="simulateDesktopDevice()">Simulate Desktop</button>
        <button class="test-button" onclick="runFullTest()">Run Full Test Suite</button>
        
        <h2>Game Integration Test</h2>
        <button class="test-button" onclick="testGameIntegration()">Test Game Integration</button>
        <button class="test-button" onclick="openGameInNewWindow()">Open Game</button>
    </div>

    <script src="device-detection.js"></script>
    <script>
        let deviceDetector;
        let testResults = [];

        // Initialize device detection
        function initializeTest() {
            try {
                deviceDetector = new DeviceDetector();
                updateDeviceInfo();
                updateOptimizationInfo();
                addTestResult('Device Detection', 'success', 'Device detector initialized successfully');
            } catch (error) {
                addTestResult('Device Detection', 'error', 'Failed to initialize device detector: ' + error.message);
            }
        }

        // Update device information display
        function updateDeviceInfo() {
            if (!deviceDetector) return;
            
            const deviceInfo = document.getElementById('deviceInfo');
            const data = deviceDetector.getPerformanceData();
            
            deviceInfo.innerHTML = `
                <h3>üì± Device Information</h3>
                <p><strong>Device Type:</strong> ${data.deviceType}</p>
                <p><strong>Screen Size:</strong> ${data.screenSize.width} x ${data.screenSize.height}</p>
                <p><strong>Screen Ratio:</strong> ${data.screenSize.ratio.toFixed(2)}</p>
                <p><strong>Touch Support:</strong> ${data.capabilities.touch ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Vibration Support:</strong> ${data.capabilities.vibration ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Orientation Support:</strong> ${data.capabilities.orientation ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>High DPI:</strong> ${data.capabilities.highDPI ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>WebGL Support:</strong> ${data.capabilities.webGL ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Memory:</strong> ${data.capabilities.memory}GB</p>
                <p><strong>CPU Cores:</strong> ${data.capabilities.cores}</p>
                <p><strong>Connection:</strong> ${data.capabilities.connection.effectiveType}</p>
            `;
        }

        // Update optimization information display
        function updateOptimizationInfo() {
            if (!deviceDetector) return;
            
            const optimizationInfo = document.getElementById('optimizationInfo');
            const optimizations = deviceDetector.optimizations;
            
            optimizationInfo.innerHTML = `
                <h3>‚öôÔ∏è Optimization Settings</h3>
                <p><strong>Target FPS:</strong> ${optimizations.targetFPS}</p>
                <p><strong>Particle Count:</strong> ${optimizations.particleCount}</p>
                <p><strong>Max Pipes:</strong> ${optimizations.maxPipes}</p>
                <p><strong>Shadows Enabled:</strong> ${optimizations.enableShadows ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Particles Enabled:</strong> ${optimizations.enableParticles ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Smoothing Enabled:</strong> ${optimizations.enableSmoothing ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Audio Quality:</strong> ${optimizations.audioQuality}</p>
                <p><strong>Preload Assets:</strong> ${optimizations.preloadAssets ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Touch Target Size:</strong> ${optimizations.touchTargetSize}px</p>
                <p><strong>Font Size:</strong> ${optimizations.fontSize}</p>
                <p><strong>Adaptive Quality:</strong> ${optimizations.adaptiveQuality ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>Pause on Blur:</strong> ${optimizations.pauseOnBlur ? '‚úÖ Yes' : '‚ùå No'}</p>
            `;
        }

        // Update performance information
        function updatePerformanceInfo() {
            const performanceInfo = document.getElementById('performanceInfo');
            
            // Get performance metrics
            const memoryInfo = performance.memory ? {
                used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
            } : null;
            
            performanceInfo.innerHTML = `
                <h3>üöÄ Performance Information</h3>
                <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                <p><strong>Platform:</strong> ${navigator.platform}</p>
                <p><strong>Language:</strong> ${navigator.language}</p>
                <p><strong>Online:</strong> ${navigator.onLine ? '‚úÖ Yes' : '‚ùå No'}</p>
                ${memoryInfo ? `
                    <p><strong>Memory Used:</strong> ${memoryInfo.used}MB / ${memoryInfo.total}MB</p>
                    <p><strong>Memory Limit:</strong> ${memoryInfo.limit}MB</p>
                ` : '<p><strong>Memory Info:</strong> Not available</p>'}
            `;
        }

        // Add test result
        function addTestResult(testName, type, message) {
            testResults.push({ testName, type, message });
            updateTestResults();
        }

        // Update test results display
        function updateTestResults() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h2>Test Results</h2>' + 
                testResults.map(result => 
                    `<div class="status ${result.type}">
                        <strong>${result.testName}:</strong> ${result.message}
                    </div>`
                ).join('');
        }

        // Test functions
        function runDeviceDetectionTest() {
            try {
                const detector = new DeviceDetector();
                const data = detector.getPerformanceData();
                
                addTestResult('Device Detection', 'success', 
                    `Detected ${data.deviceType} device with ${data.capabilities.touch ? 'touch' : 'no touch'} support`);
                
                updateDeviceInfo();
            } catch (error) {
                addTestResult('Device Detection', 'error', error.message);
            }
        }

        function runOptimizationTest() {
            try {
                const detector = new DeviceDetector();
                const optimizations = detector.optimizations;
                
                addTestResult('Optimization', 'success', 
                    `Loaded ${detector.deviceType} optimizations with ${optimizations.targetFPS} FPS target`);
                
                updateOptimizationInfo();
            } catch (error) {
                addTestResult('Optimization', 'error', error.message);
            }
        }

        function runPerformanceTest() {
            try {
                // Test canvas performance
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                if (!ctx) {
                    throw new Error('Canvas context not available');
                }
                
                // Simple performance test
                const startTime = performance.now();
                for (let i = 0; i < 1000; i++) {
                    ctx.fillRect(i % 100, i % 100, 10, 10);
                }
                const endTime = performance.now();
                
                addTestResult('Performance', 'success', 
                    `Canvas test completed in ${(endTime - startTime).toFixed(2)}ms`);
                
                updatePerformanceInfo();
            } catch (error) {
                addTestResult('Performance', 'error', error.message);
            }
        }

        function simulateMobileDevice() {
            // This is a simulation - in real usage, the device detector would handle this
            addTestResult('Simulation', 'info', 'Simulated mobile device (actual detection would require device change)');
        }

        function simulateTabletDevice() {
            addTestResult('Simulation', 'info', 'Simulated tablet device (actual detection would require device change)');
        }

        function simulateDesktopDevice() {
            addTestResult('Simulation', 'info', 'Simulated desktop device (actual detection would require device change)');
        }

        function runFullTest() {
            testResults = [];
            addTestResult('Full Test Suite', 'info', 'Starting comprehensive test suite...');
            
            setTimeout(() => runDeviceDetectionTest(), 100);
            setTimeout(() => runOptimizationTest(), 200);
            setTimeout(() => runPerformanceTest(), 300);
            setTimeout(() => {
                addTestResult('Full Test Suite', 'success', 'All tests completed successfully!');
            }, 400);
        }

        function testGameIntegration() {
            try {
                // Test if the adaptive game loader would work
                if (typeof DeviceDetector !== 'undefined' && 
                    typeof MobileUIComponents !== 'undefined' && 
                    typeof MobileGameEngine !== 'undefined' && 
                    typeof AdaptiveGameLoader !== 'undefined') {
                    addTestResult('Game Integration', 'success', 'All required classes are available');
                } else {
                    addTestResult('Game Integration', 'error', 'Some required classes are missing');
                }
            } catch (error) {
                addTestResult('Game Integration', 'error', error.message);
            }
        }

        function openGameInNewWindow() {
            try {
                const gameWindow = window.open('index.html', '_blank');
                if (gameWindow) {
                    addTestResult('Game Launch', 'success', 'Game opened in new window');
                } else {
                    addTestResult('Game Launch', 'error', 'Failed to open game (popup blocked?)');
                }
            } catch (error) {
                addTestResult('Game Launch', 'error', error.message);
            }
        }

        // Initialize tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeTest();
            updatePerformanceInfo();
            addTestResult('Page Load', 'success', 'Test page loaded successfully');
        });

        // Add some mobile-specific tests
        function testTouchEvents() {
            const testDiv = document.createElement('div');
            testDiv.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9999;';
            testDiv.innerHTML = '<div style="color:white;text-align:center;margin-top:50%;font-size:24px;">Touch anywhere to test touch events</div>';
            
            document.body.appendChild(testDiv);
            
            let touchCount = 0;
            testDiv.addEventListener('touchstart', (e) => {
                touchCount++;
                testDiv.innerHTML = `<div style="color:white;text-align:center;margin-top:50%;font-size:24px;">Touch detected! Count: ${touchCount}</div>`;
                
                if (touchCount >= 3) {
                    document.body.removeChild(testDiv);
                    addTestResult('Touch Events', 'success', `Touch events working - detected ${touchCount} touches`);
                }
            });
            
            testDiv.addEventListener('click', () => {
                document.body.removeChild(testDiv);
                addTestResult('Touch Events', 'info', 'Click event detected (touch device fallback)');
            });
            
            setTimeout(() => {
                if (document.body.contains(testDiv)) {
                    document.body.removeChild(testDiv);
                    addTestResult('Touch Events', 'info', 'Touch test timeout - no touch detected');
                }
            }, 5000);
        }

        // Add touch test button
        document.addEventListener('DOMContentLoaded', () => {
            const testButton = document.createElement('button');
            testButton.textContent = 'Test Touch Events';
            testButton.className = 'test-button';
            testButton.onclick = testTouchEvents;
            document.querySelector('.test-container').appendChild(testButton);
        });
    </script>
</body>
</html>
